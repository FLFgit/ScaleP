#######################################################################################################
#######################################################################################################
#######################################################################################################
print("Functions for the [Scale]-specific [P]rediction of soil classes and numeric parameters")   
#######################################################################################################
#######################################################################################################
#######################################################################################################
source(".../ScaleP/_function/fPackages.R")
#------------------------------------------------------------------------------------------------------
source(".../ScaleP/_function/fMosaicBKG.R")
source(".../ScaleP/_function/fCropRaster.R")
source(".../ScaleP/_function/fGrid2Poly.R")
source(".../ScaleP/_function/fSCMAP2SAGA.R")
#------------------------------------------------------------------------------------------------------
source(".../ScaleP/_function/fTerrA.R")
source(".../ScaleP/_function/fZonaSt.R")
#------------------------------------------------------------------------------------------------------
source(".../ScaleP/_function/fRFE.R")
source(".../ScaleP/_function/fClasP.R")
source(".../ScaleP/_function/fNumP.R")
source(".../ScaleP/_function/fEvaluate.R")
#######################################################################################################
#######################################################################################################
#######################################################################################################
print("Pre-Processing")
#-----------------------------------------------------------------------------------------------------
#Mosaicing of BKG DEM tiles
#-----------------------------------------------------------------------------------------------------
fSCMaP2SAGA(SCMaP.DIR,
            SCMaP.FILE,
            SCMaP.FRM,
            SCMaP.PF,
            OUT.DIR)

#-----------------------------------------------------------------------------------------------------
#Crop one- or multi.dimensional raster files
#-----------------------------------------------------------------------------------------------------
fCropRaster(RU.DIR,
            RU.SHP,
            RASTER.DIR,
            RASTER.GRD,
            RASTER.FRM,
            RASTER.EPSG,
            MULTI=FALSE,
            EXTENT=FALSE)
#-----------------------------------------------------------------------------------------------------
#Convert raster cells to polygons
#-----------------------------------------------------------------------------------------------------
fGrid2Poly(RASTER.DIR,
           RASTER.FILE,
           RASTER.EPSG,
           RASTER.FRM,
           AGG=FALSE,
           AGG.FCT=1,
           OUT.DIR)
#-----------------------------------------------------------------------------------------------------
#Convert multi-dimensional SCMaP file to single SAGA GRID files
#-----------------------------------------------------------------------------------------------------
fSCMaP2SAGA(SCMaP.DIR,
            SCMaP.FILE,
            SCMaP.FRM,
            SCMaP.PF,
            OUT.DIR)
#######################################################################################################
#######################################################################################################
#######################################################################################################
print("Parametrization")
#-----------------------------------------------------------------------------------------------------
#Calculation of multi-scale terrain attributes
#-------------------------------------------------------------------------------
fTerrA(DEM.DIR,
       DEM,
       DEM.FRM,
       OUT.DIR,
       TA,
       EPSG,
       TCI=TRUE,
       P.CA1=10000,
       P.CA2=1000000,
       P.CA3=10,
       MBI=TRUE,
       P.MBI1=0.0001,
       P.MBI2=0.1,
       P.MBI3=10,
       NH=TRUE,
       P.NH1=2,
       P.NH2=1000,
       P.NH3=10,
       TPI=TRUE,
       P.TPI1=20,
       P.TPI2=1000,
       P.TPI3=10)
#-----------------------------------------------------------------------------------------------------
#Zonal statistics
#-------------------------------------------------------------------------------
fZonaSt(TA.DIR,
        TA,
        POLYGON.DIR,
        POLYGON.SHP,
        OUT.DIR)

#-----------------------------------------------------------------------------------------------------
#Classification
#-------------------------------------------------------------------------------
fClasP(POLYGON.DIR="d:/Dropbox/_git/SOIL-DE_ScaleP/_output/",
       POLYGON.SHP="DEM10_AGGREGATE2_TA",
       TRAIN.DIR="d:/Dropbox/_git/SOIL-DE_ScaleP/_input/AUGER/",
       TRAIN.SHP="FIS_T1_EPSG31468",
       OUT.DIR="d:/Dropbox/_git/SOIL-DE_ScaleP/_output/",
       EPSG="31468",
       M.TRAIN="rf",
       PART=0.75,
       T.CLASS="BOART",
       PF.TA="TA",
       UPTRAIN=TRUE)
#-----------------------------------------------------------------------------------------------------
#Color composite
#-------------------------------------------------------------------------------
fColorComposite(DATA.DIR = OUT.DIR,
          RESULT.DIR = OUT.DIR,
          B1 = "TA3.asc",
          B2 = "TA23.asc",
          B3 = "TA15.asc",
          SHD= "TA16.asc",
          ALPHA=0.5,
          H=2000,
          W=2100,
          RES=300)
